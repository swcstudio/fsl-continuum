# FSL Continuum Reliability Configuration
# SPEC:RELIABILITY-001 - Comprehensive Reliability Settings

# Global reliability settings
global:
  version: "2.1.0"
  environment: "${{ github.repository == 'fsl-continuum/production' && 'production' || 'development' }}"
  debug_mode: false
  enable_metrics: true
  enable_alerting: true

# Guard rails configuration
guard_rails:
  input_validation:
    enabled: true
    strict_mode: true
    schema_validation: true
    security_scanning: true
    max_input_size: "10MB"
    allowed_content_types: ["application/json", "text/plain", "application/yaml"]
    
  state_validation:
    enabled: true
    checksum_verification: true
    schema_validation: true
    semantic_validation: true
    backup_before_validation: true
    max_state_size: "100MB"
    
  resource_limiting:
    enabled: true
    max_cpu_percent: 80
    max_memory_percent: 85
    max_disk_percent: 90
    max_concurrent_operations: 10
    
  rate_limiting:
    enabled: true
    api_calls_per_minute: 60
    blockchain_transactions_per_hour: 10
    state_updates_per_minute: 30
    
  dependency_health:
    enabled: true
    check_interval_seconds: 300
    failure_threshold: 3
    dependencies:
      - name: "github_api"
        url: "https://api.github.com"
        timeout: 10
      - name: "linear_api"
        url: "https://api.linear.app"
        timeout: 10
      - name: "blockchain_polygon"
        url: "https://polygon-rpc.com"
        timeout: 15

# Circuit breaker configuration
circuit_breaker:
  enabled: true
  default_config:
    failure_threshold: 5
    recovery_timeout: 60
    half_open_max_calls: 3
    success_threshold: 2
    
  services:
    github_api:
      failure_threshold: 10
      recovery_timeout: 30
      half_open_max_calls: 5
      
    linear_api:
      failure_threshold: 5
      recovery_timeout: 60
      half_open_max_calls: 3
      
    blockchain_polygon:
      failure_threshold: 3
      recovery_timeout: 120
      half_open_max_calls: 2
      
    blockchain_icp:
      failure_threshold: 3
      recovery_timeout: 120
      half_open_max_calls: 2

# Timeout management
timeouts:
  enabled: true
  
  # Operation-specific timeouts (seconds)
  api_calls:
    default: 60
    github_api: 30
    linear_api: 45
    
  file_operations:
    default: 300
    large_files: 600
    state_operations: 180
    
  blockchain_operations:
    default: 900
    polygon: 600
    icp: 900
    
  external_integrations:
    default: 120
    slack: 30
    teams: 30
    
  workflow_operations:
    default: 1800
    critical_workflows: 3600
    background_tasks: 7200

# Retry handler configuration
retry_handler:
  enabled: true
  
  default_config:
    max_retries: 3
    base_delay: 1
    max_delay: 60
    backoff_factor: 2
    jitter: true
    
  retryable_errors:
    - "network_timeout"
    - "http_5xx"
    - "rate_limit_exceeded"
    - "temporary_failure"
    - "resource_exhausted"
    
  non_retryable_errors:
    - "authentication_failed"
    - "authorization_failed"
    - "invalid_input"
    - "not_found"
    - "permission_denied"
    
  service_specific:
    github_api:
      max_retries: 5
      base_delay: 2
      
    blockchain_polygon:
      max_retries: 10
      base_delay: 5
      
    linear_api:
      max_retries: 3
      base_delay: 1

# Failover configuration
failover:
  enabled: true
  
  primary_services:
    blockchain:
      primary: "polygon"
      fallback: "icp"
      
    api_gateway:
      primary: "github"
      fallback: "cached_responses"
      
    notification:
      primary: "slack"
      fallback: "teams"
      
  failover_triggers:
    - "circuit_breaker_open"
    - "health_check_failure"
    - "timeout_exceeded"
    - "dependency_unavailable"
    
  recovery_strategies:
    - "automatic_retry"
    - "service_restart"
    - "fallback_activation"
    - "graceful_degradation"

# Error handling configuration
error_handling:
  enabled: true
  
  error_categories:
    transient:
      severity: "medium"
      auto_recovery: true
      alert_threshold: 5
      
    configuration:
      severity: "high"
      auto_recovery: false
      alert_threshold: 1
      
    dependency:
      severity: "high"
      auto_recovery: true
      alert_threshold: 3
      
    business_logic:
      severity: "medium"
      auto_recovery: false
      alert_threshold: 1
      
    infrastructure:
      severity: "critical"
      auto_recovery: true
      alert_threshold: 1
      
    security:
      severity: "critical"
      auto_recovery: false
      alert_threshold: 1
      
  recovery_strategies:
    transient: "retry_with_backoff"
    configuration: "manual_intervention"
    dependency: "circuit_breaker_failover"
    business_logic: "skip_continue"
    infrastructure: "scale_resources"
    security: "immediate_stop"

# Monitoring configuration
monitoring:
  enabled: true
  
  health_checks:
    enabled: true
    interval_seconds: 300
    timeout_seconds: 30
    
    checks:
      - name: "state_integrity"
        type: "file_check"
        path: ".github/state/continuum-state.json"
        
      - name: "blockchain_connectivity"
        type: "api_check"
        url: "https://polygon-rpc.com"
        
      - name: "disk_space"
        type: "system_check"
        metric: "disk_usage"
        threshold: 85
        
      - name: "memory_usage"
        type: "system_check"
        metric: "memory_usage"
        threshold: 80
        
  metrics:
    enabled: true
    collection_interval_seconds: 60
    retention_days: 30
    
    key_metrics:
      - "workflow_success_rate"
      - "error_rate"
      - "response_time"
      - "throughput"
      - "resource_utilization"
      - "availability"
      
  alerting:
    enabled: true
    
    channels:
      slack:
        enabled: true
        webhook_url: "${{ secrets.SLACK_WEBHOOK_URL }}"
        channel: "#fsl-reliability"
        
      email:
        enabled: true
        recipients: ["devops@company.com"]
        
      github_issues:
        enabled: true
        auto_create: true
        labels: ["reliability", "incident"]
        
    alert_rules:
      - name: "high_error_rate"
        condition: "error_rate > 5%"
        severity: "critical"
        
      - name: "service_down"
        condition: "availability < 99%"
        severity: "critical"
        
      - name: "performance_degradation"
        condition: "response_time > 5m"
        severity: "warning"

# SLA configuration
sla:
  enabled: true
  
  service_levels:
    critical_workflows:
      availability: 99.9
      response_time: 300  # 5 minutes
      error_rate: 0.1    # 0.1%
      
    normal_workflows:
      availability: 99.5
      response_time: 1800  # 30 minutes
      error_rate: 1.0      # 1%
      
    background_tasks:
      availability: 99.0
      response_time: 7200  # 2 hours
      error_rate: 5.0      # 5%
      
  monitoring:
    real_time_tracking: true
    breach_alerts: true
    historical_reporting: true
    compliance_calculations: true

# Security configuration
security:
  enabled: true
  
  audit_logging:
    enabled: true
    log_level: "info"
    include_sensitive_data: false
    
  encryption:
    state_encryption: true
    backup_encryption: true
    communication_encryption: true
    
  access_control:
    role_based_access: true
    minimal_privilege: true
    audit_access: true
    
  incident_response:
    security_incidents: true
    escalation_immediate: true
    forensic_preservation: true

# Chaos engineering
chaos_engineering:
  enabled: false  # Disabled by default, enable in staging
  
  experiments:
    - name: "api_latency_injection"
      type: "latency"
      target: "github_api"
      duration: 300
      latency_ms: 1000
      
    - name: "resource_exhaustion"
      type: "resource"
      target: "memory"
      duration: 120
      exhaustion_percent: 80
      
  safety_rules:
    - "no_experiments_in_production"
    - "automatic_rollback_on_high_error"
    - "maximum_impact_threshold"
